<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        
    </style>
</head>

<body>
    <script>
        function $(s) {
            return document.querySelector(s);
        }
        setTimeout(() => {
            new Calendar({
                element: 'body',
                top: '',
                left: '',
                limit: {
                    min: [2021, 4],
                },
                prefix: 't-',
                success(arr){
                    console.log(arr);
                }
            })   
        });
        function Calendar(config) {
            this.element = document.querySelector(config.element);
            this.top = config.top;
            this.left = config.left;
            this.limit = config.limit;
            this.success = config.success;
            this.main = document.createElement('div')
            this.main.classList.add('calendar');
            this.prefix = config.prefix;
            if(config.id){
                this.main.id = config.id;
            }
            this.html();
            this.init();
        }
        Calendar.prototype = {
            constructor: Calendar,
            show(){
                this.main.style.display = 'block';
            },
            hide(){
                this.main.style.display = 'none';
            },
            init(){
                this.currentDate = new Date();
                this.currentMonth = this.currentDate.getMonth() + 1;
                this.currentDay = this.currentDate.getDay();
                this.currentYear = this.currentDate.getFullYear();
               
                this.domDay = $('.day');
                this.arr1 = [ 4, 6, 9, 11 ];
                this.css();
                this.domPrev = $(`#${this.prefix}prev`);
                this.domNext = $(`#${this.prefix}next`);

                this.domYear = $(`#${this.prefix}year`);
                this.domMonth = $(`#${this.prefix}month`);
                this.domWeek = $(`#${this.prefix}week`);
                this.domDay = $(`.${this.prefix}day`);
                this.domYear.textContent = this.currentYear;
                this.domMonth.textContent = this.currentMonth;
                this.event();
                this.funArray = [
                    function yuandan(day){
                        if(day == 1 && this.currentMonth == 1) {
                            return `<div class="${this.isCurrentDay(day)}item">元旦</div>`
                        }
                    },
                    function current(day) {
                        if(day == this.currentDay) {
                            return `<div class="current item">${day}</div>`
                        }
                    },
                    function value(day) {
                        return `<div class="item">${day}</div>`
                    },
                ];
                this.renderDay(this.getDay(this.currentMonth));
            },
            html(){
                this.main.innerHTML = `
                    <div class="head">
                        <div class="prev" id="${this.prefix}prev"><</div>
                        <p>
                            <span id="${this.prefix}year">2021</span>年
                            <span id="${this.prefix}month">4</span>月
                        </p>
                        <div class="next" id="${this.prefix}next">></div>
                    </div>
                    <div class="${this.prefix}week">
                        <span class="item">日</span>
                        <span class="item">一</span>
                        <span class="item">二</span>
                        <span class="item">三</span>
                        <span class="item">四</span>
                        <span class="item">五</span>
                        <span class="item">六</span>
                    </div>
                    <div class="${this.prefix}day">
                        <div class="item">2</div>
                    </div>
                `;
                this.element.append(this.main);
            },
            css(){
                let style = document.createElement('style');
                style.innerHTML = `
                    .calendar {
                        position: absolute;
                        left: ${this.left}px;
                        top: ${this.top}px;
                    }
                    .calendar .head{
                        width: 280px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }
                    .calendar .prev, .calendar .next{
                        cursor: pointer;
                    }
                    .calendar .${this.prefix}week {
                        display: flex;
                        margin: 10px 0;
                    }
                    .calendar .${this.prefix}week .item {
                        width: 40px;
                        text-align: center;
                    }
                    .calendar .${this.prefix}day {
                        display: flex;
                        width: 280px;
                        flex-wrap: wrap;
                    }
                    .calendar .${this.prefix}day .item {
                        text-align: center;
                        width: 40px;
                        line-height: 30px;
                        cursor: pointer;
                        margin: 10px 0;
                    }
                    .calendar .${this.prefix}day .current {
                        background-color: #c81623;
                        color: #fff;
                    }
                `;
                document.head.append(style);
            },
            event(){
                var that = this;
                this.domPrev.onclick = function () {
                    that.changeCurrentMonth(that.currentMonth - 1)
                };
                this.domNext.onclick = function () {
                    that.changeCurrentMonth(that.currentMonth + 1)
                };
                this.domDay.onclick = function (e) {
                    if(Number(e.target.innerHTML)){
                       that.changeCurrentDay(Number(e.target.innerHTML));
                    }
                }
            },
            changeCurrentDay(day){
                this.currentDay = day;
                let child = this.domDay.children;
                for (let i = 0; i < child.length; i++) {
                    if(child[i].innerHTML == day) {
                        child[i].classList.add('current');
                    } else {
                        child[i].classList.remove('current');
                    }
                }
                this.success([this.currentYear, this.currentMonth, this.currentDay]);
            },
            changeCurrentMonth(month){
                if(this.limit){
                    if(
                        this.limit.min[0] > this.currentYear
                        ||
                        this.limit.min[1] > month
                    ){
                        return;
                    }
                }
                if(month < 1){
                    month = 12;
                    this.currentYear--;
                }
                if(month > 12){
                    month = 1;
                    this.currentYear++;
                }
                this.currentMonth = month
                $(`#${this.prefix}month`).textContent = this.currentMonth;
                $(`#${this.prefix}year`).textContent = this.currentYear;
                this.renderDay(this.getDay(month));

                this.success([this.currentYear, this.currentMonth, this.currentDay]);
            },
             getDay(month) {
                if (month == 2) {
                    return this.isYear(month) ? 29 : 28;
                } else if (this.arr1.includes(month)) {
                    return 30;
                } else {
                    return 31;
                }
            },
            getNullDay(){
                return new Date(this.currentYear,this.currentMonth-1, this.currentDay).getDay();
            },
            isYear(params) {
                if (params % 4 == 0 && params % 100 != 0) {
                    return true;
                }
                return params % 400 == 0;
            },
            isCurrentDay(day){
                return day === this.currentDay ? 'current ' : ''
            },
            renderDay(count) {
                var str = '';
                if(this.getNullDay() != 1 && this.currentMonth != 1){
                    for (let i = this.getNullDay(); i >0 ; i--) {
                        str += '<div class="item"></div>';
                    }
                }
                for (let i = 1; i <= count; i++) {
                    for (let j = 0; j < this.funArray.length; j++) {
                        let d = this.funArray[j].call(this,i);
                        if(d){
                            str += d;
                            break;
                        }
                    }
                }
                this.domDay.innerHTML = str;
            }
        }
      
        // var domDay = $('.day');
       
        // $('#prev').onclick = function () {
        //     changeMonth(--currentMonth)
        // }
        // $('#next').onclick = function () {
        //     changeMonth(++currentMonth)
        // }
        
        
        // 限制
      
        

        
    </script>
</body>

</html>